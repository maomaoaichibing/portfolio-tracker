<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Debug</title>
</head>
<body>
    <div id="attributionGrid"></div>
    <script>
        function generateAttributionFactors(symbol) {
            const seed = symbol.split('').reduce((a, b) => a + b.charCodeAt(0), 0);
            const factorNames = ['è¡Œä¸šæ”¿ç­–', 'ä¸šç»©é¢„æœŸ', 'å¤§ç›˜æƒ…ç»ª', 'èµ„é‡‘æµå‘', 'æŠ€æœ¯é¢'];
            let remaining = 100;
            return factorNames.slice(0, 4).map((name, i) => {
                const percent = i === 3 ? remaining : Math.floor((seed * (i + 1)) % 40) + 10;
                remaining -= percent;
                return { name, percent };
            });
        }

        function generateMonitoringItems(symbol, market, stock) {
            const seed = symbol.split('').reduce((a, b) => a + b.charCodeAt(0), 0);
            const items = [];
            
            const earningsDate = '2025-03-15';
            const daysToEarnings = 10;
            const earningsStatus = daysToEarnings <= 7 ? 'âš ï¸ å³å°†å‘å¸ƒ' : 'ğŸ“… 10å¤©å';
            
            items.push({
                icon: 'ğŸ“ˆ',
                name: 'ä¸šç»©é¢„æœŸ',
                desc: `ä¸‹æ¬¡è´¢æŠ¥: ${earningsDate}`,
                detail: 'å»ºè®®å…³æ³¨',
                status: earningsStatus,
                statusColor: 'orange',
                bgColor: 'background: #E6F7FF;'
            });
            
            return items;
        }
        
        function generateAIInsight(item, stock) {
            return `æµ‹è¯•è§£è¯»: ${item.name}`;
        }
        
        function showAIInsight(symbol, name, itemName, status, desc) {
            alert(`${name} - ${itemName}: ${status}`);
        }
        
        function handleAIInsightClick(e) {
            const btn = e.target.closest('.ai-insight-btn');
            if (!btn) return;
            
            const symbol = btn.dataset.symbol;
            const name = btn.dataset.name;
            const itemName = btn.dataset.item;
            const status = decodeURIComponent(btn.dataset.status);
            const desc = decodeURIComponent(btn.dataset.desc);
            
            showAIInsight(symbol, name, itemName, status, desc);
        }
        
        function renderAttributionGrid(portfolio) {
            const container = document.getElementById('attributionGrid');
            if (!container) return;
            
            container.innerHTML = portfolio.map(stock => {
                const factors = generateAttributionFactors(stock.symbol);
                const monitoringItems = generateMonitoringItems(stock.symbol, stock.market, stock);
                
                return `
                    <div class="monitor-card">
                        <div>${stock.name} (${stock.symbol})</div>
                        <div>
                            ${monitoringItems.map(item => `
                                <div>
                                    <span>${item.name}: ${item.status}</span>
                                    <button class="ai-insight-btn" data-symbol="${stock.symbol}" data-name="${stock.name}" data-item="${item.name}" data-status="${encodeURIComponent(item.status)}" data-desc="${encodeURIComponent(item.desc)}">AIè§£è¯»</button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // æµ‹è¯•æ•°æ®
        const testPortfolio = [
            { symbol: '00700', name: 'è…¾è®¯', market: 'HK' },
            { symbol: 'BABA', name: 'é˜¿é‡Œ', market: 'US' }
        ];
        
        renderAttributionGrid(testPortfolio);
        
        const attributionGrid = document.getElementById('attributionGrid');
        if (attributionGrid) {
            attributionGrid.addEventListener('click', handleAIInsightClick);
        }
    </script>
</body>
</html>
