/**analysis.wxml**/
<view class="page-container">
  <!-- åˆ†æç±»å‹åˆ‡æ¢ -->
  <view class="tab-bar">
    <view class="tab-item {{activeTab === 'portfolio' ? 'active' : ''}}" bindtap="switchTab" data-tab="portfolio">
      ç»„åˆåˆ†æ
    </view>
    <view class="tab-item {{activeTab === 'stocks' ? 'active' : ''}}" bindtap="switchTab" data-tab="stocks">
      ä¸ªè‚¡åˆ†æ
    </view>
    <view class="tab-item {{activeTab === 'alerts' ? 'active' : ''}}" bindtap="switchTab" data-tab="alerts">
      ç›‘æ§æé†’
    </view>
  </view>

  <!-- ç»„åˆåˆ†æ -->
  <view wx:if="{{activeTab === 'portfolio'}}" class="tab-content">
    <!-- ç»„åˆæ¦‚è§ˆ -->
    <view class="card">
      <text class="card-title">ç»„åˆæ¦‚è§ˆ</text>
      
      <view class="overview-grid">
        <view class="overview-item">
          <text class="overview-value {{portfolioStats.totalReturn >= 0 ? 'text-success' : 'text-danger'}}">
            {{portfolioStats.totalReturn >= 0 ? '+' : ''}}{{portfolioStats.totalReturn}}%
          </text>
          <text class="overview-label">æ€»æ”¶ç›Šç‡</text>
        </view>
        
        <view class="overview-item">
          <text class="overview-value">{{portfolioStats.volatility}}%</text>
          <text class="overview-label">æ³¢åŠ¨ç‡</text>
        </view>
        
        <view class="overview-item">
          <text class="overview-value">{{portfolioStats.sharpeRatio}}</text>
          <text class="overview-label">å¤æ™®æ¯”ç‡</text>
        </view>
        
        <view class="overview-item">
          <text class="overview-value">{{portfolioStats.maxDrawdown}}%</text>
          <text class="overview-label">æœ€å¤§å›æ’¤</text>
        </view>
      </view>
    </view>

    <!-- è¡Œä¸šåˆ†å¸ƒ -->
    <view class="card">
      <text class="card-title">è¡Œä¸šåˆ†å¸ƒ</text>
      
      <view class="sector-list">
        <view wx:for="{{sectorDistribution}}" wx:key="name" class="sector-item">
          <view class="sector-info">
            <text class="sector-name">{{item.name}}</text>
            <text class="sector-percent">{{item.percent}}%</text>
          </view>
          
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{item.percent}}%; background: {{item.color}}"></view>
          </view>
        </view>
      </view>
    </view>

    <!-- é£é™©è¯„ä¼° -->
    <view class="card">
      <text class="card-title">é£é™©è¯„ä¼°</text>
      
      <view class="risk-list">
        <view wx:for="{{riskFactors}}" wx:key="index" class="risk-item">
          <text class="risk-name">{{item.name}}</text>
          
          <view class="risk-level">
            <text class="risk-badge {{item.level}}">{{item.levelText}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸ªè‚¡åˆ†æ -->
  <view wx:if="{{activeTab === 'stocks'}}" class="tab-content">
    <view class="stock-selector">
      <scroll-view scroll-x class="stock-tabs">
        <view wx:for="{{portfolio}}" wx:key="id" 
              class="stock-tab {{selectedStock.symbol === item.symbol ? 'active' : ''}}"
              bindtap="selectStock"
              data-stock="{{item}}">
          {{item.name}}
        </view>
      </scroll-view>
    </view>

    <view wx:if="{{selectedStock.symbol}}">
      <!-- AI åˆ†æ -->
      <view class="card">
        <view class="flex-between">
          <text class="card-title">AI æŠ•èµ„åˆ†æ</text>
          <text class="analysis-date">{{stockAnalysis.date}}</text>
        </view>
        
        <text class="analysis-summary">{{stockAnalysis.summary}}</text>
        
        <view class="analysis-section">
          <text class="section-title">ğŸ“ˆ æ ¸å¿ƒé©±åŠ¨å› ç´ </text>
          
          <view wx:for="{{stockAnalysis.drivers}}" wx:key="index" class="driver-item">
            <text class="driver-name">{{item.factor}}</text>
            <text class="driver-impact {{item.impact}}">{{item.impactText}}</text>
          </view>
        </view>
        
        <view class="analysis-section">
          <text class="section-title">âš ï¸ é£é™©å› ç´ </text>
          
          <view wx:for="{{stockAnalysis.risks}}" wx:key="index" class="risk-text">
            â€¢ {{item}}
          </view>
        </view>
      </view>

      <!-- ç›‘æ§æŒ‡æ ‡ -->
      <view class="card">
        <text class="card-title">ç›‘æ§æŒ‡æ ‡</text>
        
        <view class="metric-list">
          <view wx:for="{{stockAnalysis.metrics}}" wx:key="name" class="metric-item">
            <view class="metric-header">
              <text class="metric-name">{{item.name}}</text>
              
              <text class="metric-value {{item.status}}">{{item.currentValue}}</text>
            </view>
            
            <text class="metric-threshold">é˜ˆå€¼: {{item.threshold}}</text>
          </view>
        </view>
      </view>
    </view>

    <view wx:else class="empty-state">
      <text class="empty-text">è¯·é€‰æ‹©è‚¡ç¥¨æŸ¥çœ‹åˆ†æ</text>
    </view>
  </view>

  <!-- ç›‘æ§æé†’ -->
  <view wx:if="{{activeTab === 'alerts'}}" class="tab-content">
    <view wx:if="{{alerts.length > 0}}">
      <view wx:for="{{alerts}}" wx:key="id" class="alert-card {{item.priority}}">
        <view class="alert-header">
          <text class="alert-title">{{item.title}}</text>
          
          <text class="alert-time">{{item.time}}</text>
        </view>
        
        <text class="alert-content">{{item.content}}</text>
        
        <view class="alert-footer">
          <text class="alert-stock">{{item.stockName}} ({{item.symbol}})</text>
          
          <button wx:if="{{!item.isRead}}" size="mini" type="primary" bindtap="markAsRead" data-id="{{item.id}}">
            æ ‡è®°å·²è¯»
          </button>
          
          <text wx:else class="read-badge">å·²è¯»</text>
        </view>
      </view>
    </view>

    <view wx:else class="empty-state">
      <image class="empty-icon" src="/images/empty-alerts.png" mode="aspectFit"></image>
      <text class="empty-text">æš‚æ— æé†’</text>
      <text class="empty-subtext">å½“ç›‘æ§æŒ‡æ ‡è§¦å‘æ—¶ï¼Œä¼šåœ¨è¿™é‡Œæ˜¾ç¤º</text>
    </view>
  </view>
</view>
